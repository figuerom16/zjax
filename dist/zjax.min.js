(function(){"use strict";const C=["GET","POST","PUT","PATCH","DELETE"],U=["outer","inner"],I=["outer","inner","before","after","prepend","append","none","delete"],K=document.startViewTransition!==void 0,b=["id","z-swap","z-action","z-confirm","z-active","z-validate"],N=["document","window","once","prevent","stop"],v=["delay","debounce"],E=["click","auxclick","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mouseenter","mouseleave","context"],O=["ctrl","shift","alt","meta"],A=["keydown","keyup"],j=["keyName","ctrl","shift","alt","meta"],W={enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",insert:"Insert",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",space:" ",comma:",",period:".",semicolon:";",singlequote:"'",doublequote:'"',backtick:"`",slash:"/",backslash:"\\",bracketleft:"[",bracketright:"]",curlybracketleft:"{",curlybracketright:"}",minus:"-",equal:"=",plus:"+",underscore:"_",ampersand:"&",asterisk:"*",at:"@",dollar:"$",percent:"%",caret:"^",exclamation:"!",tilde:"~",pipe:"|",colon:":",question:"?",underscore:"_",lessthan:"<",greaterthan:">",hash:"#"};function B(e,t){return!(A.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey||e.modifiers.keyName&&t.key!==e.modifiers.keyName&&e.modifiers.keyName!=="any"))}function Z(e,t){return!(E.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey))}function G(e,t){return!(e.modifiers.outside&&e.node.contains(t.target))}function H(e){return e.node.hasFiredOnce?!1:(e.modifiers.once&&(e.node.hasFiredOnce=!0),!0)}function J(e,t){return e.modifiers.prevent&&t.preventDefault(),e.modifiers.stop&&t.stopPropagation(),!0}async function V(e){return e.modifiers.delay&&await new Promise(t=>setTimeout(t,e.modifiers.delay)),!0}function T(e,t){let n;return function(...o){const i=this;clearTimeout(n),n=setTimeout(()=>{e.apply(i,o)},t)}}function z(e,t){const n=[];return n.push(...e.querySelectorAll(t)),!(e instanceof Document)&&e.matches(t)&&n.push(e),n}function p(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function X(){return{debug:!1,transitions:!0,actions:{},errors:{},parse:function(){w(document),y(document)}}}function u(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}function $(e,t,n=null){const o=new Proxy(function(){},{apply(i,s,r){if(r.length===0)return e;if(r.length===1){const a=document.querySelector(r[0]);if(!a)throw new Error(`$('${r[0]}') did not match any elements in the DOM.`);return a}throw new Error("$() can be called with a maximum of one argument.")},get(i,s){if(s==="event")return i.event;if(s==="all")return function(r){return document.querySelectorAll(r)};if(s==="redirect")return function(r){window.location=r};if(s==="response")return n}});return o.event=t,o}function _(e,t){const n=e.response||{};if(zjax.errors[n.status]){zjax.errors[n.status](e);return}if(zjax.errors.catchAll){zjax.errors.catchAll(e);return}throw new Error(`${n.status} ${n.statusText} for ${endpoint}`)}function D(e,t){const n=[],o=e.split(/,\s*(?=@)/);for(const i of o){const s=i.match(/^(@\w+[\w\-\.]+|@\[[\w\-\.\,\s]+\])?(.*)/),r=s[1]?s[1].replace(/[@\[\]\s]/g,""):"",a=s[2]?s[2].trim():"";if(!r)throw new Error(`Missing @<trigger> string in "${i}"`);const c=r.split(",");for(const l of c){const m=l.split("."),q=m.shift(),L=Q(q,m),g=Object.keys(L);let h;g.includes("document")?h=document:g.includes("window")||g.includes("outside")?h=window:h=t,n.push({event:q,modifiers:L,target:h,node:t,handlerString:a})}}return n}function Q(e,t){const n=E.includes(e),o=A.includes(e),i={};let s=o?"keyName":null;for(const r of t){if(N.includes(r)){i[r]=!0;continue}if(n&&O.includes(r)){i[r]=!0;continue}if(o&&j.includes(r)){i[r]=!0;continue}if(r==="once"){i[r]=!0;continue}if(r==="outside"&&(n||o)){i[r]=!0;continue}if(o&&s==="keyName"){i[s]=W[r]||r,s=null;continue}if(v.includes(r)){s=r;continue}if(s&&v.includes(s)){const a=r.match(/\d+s/),c=r.match(/\d+ms/);if(!a&&!c)throw new Error(`Invalid timer value: ${r}`);i[s]=a?parseInt(a[0])*1e3:parseInt(c[0]),s=null;continue}throw new Error(`Unknown trigger modifier in this context: ${r}`)}return i}let x=0;const f={};function M(e,t,n=!1){x++;const o=`handler${x}`,i=e.event==="mount"?`mount:${o}`:e.event;f[o]={target:e.target,event:i,handlerFunction:async function(s){if(!B(e,s)||!Z(e,s)||!G(e,s)||!H(e)||(J(e,s),!await V(e)))return;const r=n?$(e.node,s):s;if(T){T(t,e.modifiers.debounce)(r);return}await t(r)}},e.target.addEventListener(i,f[o].handlerFunction),ee(e,o),e.event==="mount"&&e.target.dispatchEvent(new Event(i))}function Y(){u("Removing all zjax event listeners");for(const e in f){const t=f[e];t.target.removeEventListener(t.event,t.handlerFunction),delete f[e]}}function ee(e,t){const n=new MutationObserver(o=>{for(const i of o)for(const s of i.removedNodes)if(s===e.node||s.contains(e.node)){f[t]&&e.target.removeEventListener(e.event,f[t].handlerFunction),delete f[t],zjax.debug&&u(`Removing event listener for ${p(e.node)} (no longer in DOM)`),n.disconnect();return}});n.observe(document,{childList:!0,subtree:!0})}async function w(e){const t=z(e,"[z-swap]");u(`Found ${t.length} z-swap nodes in ${p(e)}`);for(const n of t)try{const o=n.getAttribute("z-swap"),i=D(o,n);for(const s of i){const r=te(s),a=re(s,r);M(s,a,!0),u(`Added z-swap for '${s.event}' events to ${p(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-swap: ${o.message}
`,n,o.stack)}}function te({handlerString:e,node:t}){e=ue(e);const n=e.split(/\s/);if(n.length<1||n.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");const o={},i=[];for(;n.length>0;){const s=n.shift(),r=ne(s);r?o[r[0]]=r[1]:i.push(s)}return o.swaps=oe(i.join(" ")),o.method||(o.method=t.tagName==="FORM"&&t.method?t.method:"GET"),o.endpoint||(t.tagName==="FORM"?o.endpoint=t.action:t.tagName==="A"?o.endpoint=t.href:o.endpoint=""),o}function ne(e){if(C.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function oe(e){const t=[];for(const n of e.split(",")){const o={},i=n.split("->")||[],s=i.pop(),[r,a]=s.split("|"),c=i[0]||"",[l,m]=(c==null?void 0:c.split("|"))||[null,null];if(o.response=l||r,o.target=r,o.responseType=(m==null?void 0:m.trim())||"outer",o.swapType=(a==null?void 0:a.trim())||"outer",o.responseType&&!U.includes(o.responseType))throw new Error(`Invalid swap type: ${o.responseType}`);if(o.swapType&&!I.includes(o.swapType))throw new Error(`Invalid swap type: ${o.swapType}`);if(o.response==="*"&&o.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(o.target==="*"&&o.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');t.push(o)}return t}function re(e,t){return async n=>{n.event.preventDefault();let o=e.node.form||e.node.closest("form");t.formData=new FormData(o??void 0),!o&&e.node.name&&t.formData.append(e.node.name,e.node.value),!["file","image"].includes(e.node.type)&&!(o!=null&&o.querySelector('input[type="file"], input[type="image"]'))&&(t.formData=new URLSearchParams(t.formData)),/GET|DELETE/.test(t.method)&&(t.formData.size&&(t.endpoint+=(/\?/.test(t.endpoint)?"&":"?")+t.formData),t.formData=null),u("z-swap triggered for",t);try{const i=await fetch(t.endpoint,{method:t.method,body:t.formData});if(!i.ok){const r=$(e.node,n,i);_(r,e);return}const s=new DOMParser().parseFromString(await i.text(),"text/html");u(`z-swap response from ${t.endpoint} received and parsed`);for(const r of t.swaps){const a=document.querySelector(r.target);a&&a.classList.add("zjax-swapping");const[c,l]=ie(s,r);u("Parsing incoming response for z-swaps"),c&&(w(c),y(c)),K&&zjax.transitions?document.startViewTransition(()=>{k(l,c,r.swapType,r.responseType)}):k(l,c,r.swapType,r.responseType)}}catch(i){console.error(`ZJAX ERROR – Unable to execute z-swap function: ${i.message}
`,e.node,i.stack)}}}function ie(e,t){let n;if(t.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(t.target);const o=t.response==="*"?e:e.querySelector(t.response);if(!n&&t.swapType!=="none")throw new Error(`Target node '${t.target}' does not exist in local DOM`);if(!o&&t.swapType!=="none"&&t.swapType!=="delete")throw new Error(`Source node ${t.response} does not exist in response DOM`);return[o,n]}function se(e,t){const n={},o=ae(e,"[id]");for(const i of o)if(F(t,`[id="${i.id}"]`)){const r=S(i),a=S(t);R(t),P(t,r),n[i.id]=a}return[t,n]}function k(e,t,n,o){t=o==="inner"?t.childNodes:t;let i;[t,i]=se(e,t);const s=ce(t);if(n==="outer"){const r=e.parentNode;for(const a of s)r.insertBefore(a,e);r.removeChild(e),d(t,i);return}if(n==="inner"){e.textContent="";for(const r of s)e.appendChild(r);d(t,i);return}if(n==="before"){for(const r of s)e.parentNode.insertBefore(r,e);d(t,i);return}if(n==="after"){const r=e.parentNode;let a=e;for(const c of s)c===r.lastChild?r.appendChild(c):r.insertBefore(c,a.nextSibling),a=c;d(t,i);return}if(n==="prepend"){const r=e.firstChild;for(const a of s)r?e.insertBefore(a,r):e.appendChild(a);d(t,i);return}if(n==="append"){for(const r of s)e.appendChild(r);d(t,i);return}if(n==="delete"){e.remove();return}}function F(e,t){return e.matches(t)?e:e.querySelector(t)}function ae(e,t){const n=[];return e.matches(t)&&n.push(e),n.push(...e.querySelectorAll(t)),n}function S(e){const t=[];for(const n of Array.from(e.attributes).filter(o=>!b.includes(o.name)))t.push([n.name,n.value]);return t}function P(e,t){for(const[n,o]of t)e.setAttribute(n,o)}function R(e){for(const t of Array.from(e.attributes))b.includes(t.name)||e.removeAttribute(t.name)}async function d(e,t){setTimeout(()=>{for(const[n,o]of Object.entries(t)){const i=F(e,`[id="${n}"]`);i&&(R(i),P(i,o))}Object.keys(t).map(n=>`#${n}`).join(", ")},20)}function ce(e){if(e instanceof Document){const t=e.querySelector("html");if(t)return Array.from(t.childNodes);const n=document.createDocumentFragment();for(const o of e.childNodes)n.appendChild(o);return Array.from(n.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function ue(e){return e.replace(/\s*,\s*/g,",")}function y(e){const t=z(e,"[z-action]");u(`Found ${t.length} z-action nodes in ${p(e)}`);for(const n of t)try{const o=n.getAttribute("z-action"),i=D(o,n);for(const s of i){const r=fe(s);n.handlerId=M(s,r,!0),u(`Added z-action for '${s.event}' events to ${p(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-action: ${o.message}
`,n,o.stack)}}function fe(e){return async function(t){await de(e)(t)}}function de({handlerString:e}){if(e.match(/^(\w+)((\.\w+)*)$/)){const n=le(e);if(!n)throw new Error(`Unable to find z-action function: zjax.actions.${e}`);return n}try{return new Function("$",e)}catch(n){throw new Error(`z-action value is invalid: ${n.message}`)}}function le(e){let t=zjax.actions;const n=e.split("."),o=n.slice(0,-1),i=n[n.length-1];for(const s of o){if(!t[s])return;t=t[s]}return t[i]?t[i].bind(t):void 0}window.zjax=X(),document.addEventListener("DOMContentLoaded",()=>{u("Parsing DOM on document load"),w(document),y(document)}),document.addEventListener("turbo:load",()=>{u("Parsing DOM on turbo:load"),Y(),w(document),y(document)})})();
